<%- include("./partials/head.ejs") %>
<link rel="stylesheet" href="/css/appointmentinfo.css">
<body>
   <%- include("./partials/nav.ejs") %>

  
  <section>
    <%- include("./partials/sidenav.ejs") %>

    <div class="table-box">

      <div class="table-row table-head">
          <div class="table-cell first-cell">
              <p>Mã lịch hẹn</p>
          </div>
          <div class="table-cell">
              <p>Trạng thái</p>
          </div>
          <div class="table-cell">
            <p>Phiếu khám bệnh</p>
        </div>
        <div class="table-cell last-cell">
            <p>Xóa</p>
        </div> 
      </div>
      
      <% if(appointments.length>0){ %>
        <% appointments.forEach(appointment => { %>
        <div class="table-row">
          <div class="table-cell first-cell">
              <p>
                 <a href="/appointmentdetail/<%= appointment._id %>"><%= appointment._id%>
                </a>
              </p>
          </div>
       
          <div class="table-cell">
            <p><%= appointment.status %></p>
        </div>
        <div class="table-cell">
          <a href="/appointmentmedicalform/<%= appointment._id %>" > Xem phiếu khám bệnh </a>
      </div>
        <div class="table-cell last-cell">
              <a  class="trashBin" data-doc="<%= appointment._id %> " >
                <img src="/HinhAnh/trash.png" alt="#" >
              </a>
            </div>   
      </div>
      <% }) %>
      <% }else{%>
        <p>Không có lịch hẹn nào...</p>
        <% } %>
      </div>  
</section>

<script>
  const trashBins = document.querySelectorAll('.trashBin');
  Array.from(trashBins).forEach((trashBin)=>{
    trashBin.addEventListener('click',(e)=>{
    const id = `/appointmentinfo/${trashBin.dataset.doc}`;
    fetch(id,{
      method:'DELETE',
    })
    .then(response => response.json())
    .then(data => window.location.href=data.redirect)
    .catch(err=> console.log(err));
  })
  })
  
  

</script>

</body>

</html>
